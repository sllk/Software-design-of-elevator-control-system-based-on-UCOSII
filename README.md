# uC/OS II课程大作业 电梯控制系统

- [uC/OS II课程大作业 电梯控制系统](#ucos-ii课程大作业-电梯控制系统)
    - [文件说明](#文件说明)
    - [log](#log)
    - [任务分配](#任务分配)
    - [串口通信协议](#串口通信协议)
    - [请求判优算法](#请求判优算法)


### 文件说明

`Client`文件夹内为上位机程序

`elevator`文件夹内为单片机程序    

### log

* V1.0 使用stm32F401 ，LCD调通，正在驱动矩阵键盘
  	遇到问题：uC/OS系统下按键扫描应该放在什么地方...
* V1.1 更改方案：使用F103ZET6，移植太难了，打算制作一个软件上位机，和单片机串口通信

* 2023.5.3：~~狠狠拿下~~  拿下不了一点，单片机部分实现了，开始做上位机程序

### 任务分配

* 任务0：
  * 从上位机接收指令
  * 从指令中提取数据

* 任务1：
  * 控制电梯运动状态
  * 将当前楼层及运动状态发送至上位机

* 任务2
  * 将上位机发送的请求进行优先级排序，发送到任务1

### 串口通信协议

* 楼层请求电梯

  | 帧头 | 所在楼层 | 上/下行 |   帧尾    |
  | ---- | -------- | ------- | :-------: |
  | 0x01 | 0x08     | 0x01    | 0x0D+0x0A |

  示例：01 08 01 0D 0A		8层有人要上楼

* 电梯内用户请求楼层

  | 帧头 | 目的楼层 | 帧尾      |
  | :--: | -------- | --------- |
  | 0x02 | 0x08     | 0x0D+0x0A |

  示例：02 08 0D 0A			电梯内用户要去8层

### 请求判优算法

|  -4  |  -3  |  -2  |  -1  |  1   |  2   |  3   |  4   |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|  0   |  0   |  0   |  0   |  0   |  0   |  0   |  0   |

将每一个楼层分为两部分，即~~一楼下~~、一楼上、二楼下、二楼上....做成一个表格，如上表所示。定义一个指针，指针在数组中循环扫描，查找电梯当前需要前往的楼层。
